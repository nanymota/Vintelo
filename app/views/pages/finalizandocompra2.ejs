<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vintélo</title>
  <link rel="stylesheet" href="css/finalizandocompra.css">
  <link rel="stylesheet" href="css/finalizando2.css">

  <link rel="icon" href="/imagens/brilhoescuro.png" type="image/x-icon">
  
</head>
<body>
  <section class="oculto-mobile">
    <header>
      <section class="top-bar">
          <p>10% OFF na primeira compra</p>
      </section>
      <section class="main-header">
          <img src="imagens/logo.png" class="img-logo">
          <nav>
              <a href="/categorias">Vestidos</a>
              <a href="/categorias">Saias</a>
              <a href="/categorias">Blusas</a>
              <a href="/categorias">Calças</a>
              <a href="/categorias">Outros</a>
          </nav>
          <section class="search-profile">
              <form>
                  <input type="text" placeholder="Buscar...">
              </form>
              <ul>
                  <li><a href="/cadastro" ><img src="imagens/icone sem cadastro.png" class="img-tamanho"></a> </li>
                  <li><a href="#/carrinho" ><img src="imagens/carrinho3.png" class="img-tamanho"></a> </li>
                  <li><a href="/favorito" ><img src="imagens/icone coraçao.png" class="img-tamanho"> </a></li>
              </ul>
          </section>
      </section>
  </header>
  </section>
  <!-- Header -->
  <section class="oculto-desktop">
    <header>
    <nav class="grid">
      <a href="/carrinho">
        <img src="imagens/seta.png" alt="Seta Voltar">
      </a>
      <h1>Sacola</h1>
      <img src="imagens/foto-branca.png" alt="Descrição da Imagem" />
    </nav>
  </header>
  <main>
  <!-- Produto Adicionado -->
  <!-- Notificação -->
  <section class="notification" id="notification" style="display: none;">
    <p id="notification-text"></p>
    <button onclick="closeNotification()">×</button>
  </section>

  <section class="product-section">
    <% if (carrinho && carrinho.length > 0) { %>
        <% carrinho.forEach((item, index) => { %>
            <article class="product-card1">
                <img src="<%= item.imagem %>" alt="<%= item.nome %>" class="product-img">
                <section class="product-info">
                    <h3><%= item.nome %></h3>
                    <% if (item.cor) { %><p>Cor: <%= item.cor %></p><% } %>
                    <% if (item.estilo) { %><p>Estilo: <%= item.estilo %></p><% } %>
                    <% if (item.estampa) { %><p>Estampa: <%= item.estampa %></p><% } %>
                    <% if (item.tamanho) { %><p>Tamanho: <%= item.tamanho %></p><% } %>
                    <p>R$<%= item.preco.toFixed(2) %></p>
                    <section class="quantity-control">
                        <button class="qty-btn" onclick="decreaseQuantity('<%= item.produto_id %>')">-</button>
                        <span class="quantity" id="qty-<%= item.produto_id %>"><%= item.quantidade %></span>
                        <button class="qty-btn" onclick="increaseQuantity('<%= item.produto_id %>')">+</button>
                    </section>
                </section>
                <button class="remove-item" onclick="removeItem('<%= item.produto_id %>')">
                    <img src="imagens/lixeira.png" class="lixeira">
                </button>
            </article>
        <% }) %>
    <% } else { %>
        <article class="product-card1">
            <img src="imagens/vestido branco.png" alt="Vestido Branco Longo" class="product-img">
            <section class="product-info">
                <h3>Vestido Branco</h3>
                <p>Cor:Branco</p>
                <p>Estilo:Sensual</p>
                <p>Estampa:Simples</p>
                <p>R$49,90</p>
                <section class="quantity-control">
                    <button class="qty-btn" onclick="decreaseQuantity('produto2')">-</button>
                    <span class="quantity" id="qty-produto2">1</span>
                    <button class="qty-btn" onclick="increaseQuantity('produto2')">+</button>
                </section>
            </section>
            <button class="remove-item" onclick="removeItem('produto2')">
                <img src="imagens/lixeira.png" class="lixeira">
            </button>
        </article>
    <% } %>
  </section>



  <!-- Informações do Pedido -->
  <section class="order-info">
      <!-- Cálculo de Frete -->
  <section class="shipping-section">
    <h4>Calcular frete</h4>
    <form class="shipping-form">
      <input type="text" id="cep" placeholder="Digite seu CEP" maxlength="9">
      <button type="button" onclick="calculateShipping()">Calcular</button>
    </form>
    <section class="shipping-options" id="shipping-options" style="display: none;">
      <p>Opções de entrega:</p>
      <label><input type="radio" name="shipping" value="10.00" onchange="updateShipping(10.00)"> PAC - R$ 10,00 (5-7 dias)</label>
      <label><input type="radio" name="shipping" value="15.00" onchange="updateShipping(15.00)"> SEDEX - R$ 15,00 (2-3 dias)</label>
    </section>
  </section>
    <h4>Informações do pedido</h4>
    <section class="order-details">
      <p>Subtotal</p><p id="subtotal">R$<%= subtotal || '49,90' %></p>
      <p>Frete</p><p id="shipping-cost">R$<%= frete || '10,00' %></p>
      <p>Desconto</p><p id="discount">R$0,00</p>
      <p><strong>Total</strong></p><p><strong id="total">R$<%= total || '59,90' %></strong></p>
    </section>
  </section>

  <!-- Cupom de Desconto -->
  <section class="discount-section">
    <h4>Inserir cupom de desconto</h4>
    <form class="discount-input">
      <input type="text" placeholder="Digite o cupom">
      <button class="apply-button">Inserir</button>
    </form>
  </section>

  <!-- Adicionar mais ao carrinho -->
  <section class="suggestions-section">
    <h4>Adicione mais á sacola</h4>
    <ul class="product-list">
      <li class="product-suggestion">
        <img src="imagens/conjunto.png" alt="Saia Branca">
        <p>Saia Branca</p>
        <p>R$25,00</p>
        <a href="" ><button class="adicionar-compra">Adicionar</button></a> 
      </li>
      <li class="product-suggestion">
        <img src="imagens/saia preta.png" alt="Saia Preta">
        <p>Saia Preta</p>
        <p>R$30,00</p>
        <a href="" ><button class="adicionar-compra">Adicionar</button></a> 
      </li>
      <li class="product-suggestion">
        <img src="imagens/saia marrom-2.png" alt="Saia de Veludo">
        <p>Saia de Veludo</p>
        <p>R$25,00</p>
        <a href="" ><button class="adicionar-compra">Adicionar</button></a> 
      </li>
      <li class="product-suggestion">
        <img src="imagens/saia rosa brilhante-2.png" alt="Saia Rosa Brilhante">
        <p>Saia Rosa Brilhante</p>
        <p>R$25,00</p>
        <a href="" ><button class="adicionar-compra">Adicionar</button></a> 
      </li>
      <li class="product-suggestion">
        <img src="imagens/saia marrom de couro-2.png" alt="Saia de Vinil">
        <p>Saia de Vinil</p>
        <p>R$25,00</p>
        <a href="" ><button class="adicionar-compra">Adicionar</button></a> 
      </li>
    </ul>
    <Br>
    <a href="/favoritos" class="link-branco"><p class="favorites-link">Conferir peças favoritas ></p></a> 
    <br>
    <br>
  </section>
  <a href="/finalizandopagamento"><button class="finalizar-compra">Finalizar Compra</button></a> 
  </section>
  </section>
</section>
  <!--  parte para desktop-->
    <section class="oculto-mobile">
      <section class="sacola-container">
        <h1 class="adicionar">Sacola</h1>
        <section class="sacola-content">
            <% if (carrinho && carrinho.length > 0) { %>
                <% carrinho.forEach((item, index) => { %>
                    <section class="produto-card">
                        <img src="<%= item.imagem %>" alt="<%= item.nome %>">
                        <section class="produto-info">
                            <h2><%= item.nome %></h2>
                            <% if (item.cor) { %><p>Cor: <%= item.cor %></p><% } %>
                            <% if (item.estilo) { %><p>Estilo: <%= item.estilo %></p><% } %>
                            <% if (item.estampa) { %><p>Estampa: <%= item.estampa %></p><% } %>
                            <% if (item.tamanho) { %><p>Tamanho: <%= item.tamanho %></p><% } %>
                            <p>R$<%= item.preco.toFixed(2) %></p>
                            <section class="quantity-control-desktop">
                                <button class="qty-btn" onclick="decreaseQuantity('<%= item.produto_id %>')">-</button>
                                <span class="quantity" id="qty-<%= item.produto_id %>"><%= item.quantidade %></span>
                                <button class="qty-btn" onclick="increaseQuantity('<%= item.produto_id %>')">+</button>
                            </section>
                        </section>
                        <button class="remove-btn" onclick="removeItem('<%= item.produto_id %>')">
                            <img src="imagens/lixeira.png" class="lixeira2">
                        </button>
                    </section>
                <% }) %>
            <% } else { %>
                <section class="produto-card">
                    <img src="imagens/vestido branco.png" alt="Vestido branco com decote">
                    <section class="produto-info">
                        <h2>Vestido branco com decote</h2>
                        <p>Cor: Branco</p>
                        <p>Estilo: Sensual</p>
                        <p>Estampa: Simples</p>
                        <p>R$49,90</p>
                        <section class="quantity-control-desktop">
                            <button class="qty-btn" onclick="decreaseQuantity(2)">-</button>
                            <span class="quantity" id="qty-2">1</span>
                            <button class="qty-btn" onclick="increaseQuantity(2)">+</button>
                        </section>
                    </section>
                    <button class="remove-btn" onclick="removeItem(2)">
                        <img src="imagens/lixeira.png" class="lixeira2">
                    </button>
                </section>
            <% } %>
            <section class="pedido-info">
                <!-- Cálculo de Frete Desktop -->
                <section class="shipping-desktop">
                  <h3>Calcular frete</h3>
                  <section class="shipping-form-desktop">
                    <input type="text" id="cep-desktop" placeholder="Digite seu CEP" maxlength="9">
                    <button type="button" onclick="calculateShippingDesktop()">Calcular</button>
                  </section>
                  <section class="shipping-options-desktop" id="shipping-options-desktop" style="display: none;">
                    <label><input type="radio" name="shipping-desktop" value="10.00" onchange="updateShippingDesktop(10.00)"> PAC - R$ 10,00</label>
                    <label><input type="radio" name="shipping-desktop" value="15.00" onchange="updateShippingDesktop(15.00)"> SEDEX - R$ 15,00</label>
                  </section>
                </section>
                
                <h2>Informações do pedido</h2>
                <section class="pedido-detalhes">
                    <section class="detalhe">
                        <span>Subtotal</span>
                        <span id="subtotal-desktop">R$ <%= subtotal || '49,90' %></span>
                    </section>
                    <section class="detalhe">
                        <span>Frete</span>
                        <span id="shipping-cost-desktop">R$ <%= frete || '10,00' %></span>
                    </section>
                    <section class="detalhe">
                        <span>Desconto</span>
                        <span id="discount-desktop">R$ 0,00</span>
                    </section>
                    <section class="detalhe total">
                        <span>Total</span>
                        <span id="total-desktop">R$ <%= total || '59,90' %></span>
                    </section>
                </section>
                <section class="cupom">
                    <input type="text" placeholder="Inserir cupom de desconto">
                    <button>Inserir</button>
              </section>
                <a href="/finalizandopagamento"><button class="finalizar-compra">Finalizar Compra</button></a> 
              </section>
        </section>
    </section>

               <!--                                        PRODUTOS OCULTOS                                               -->
               <section class="produtos-ocultos">
                  <h1 class="adicionar">Adicione mais à sacola</h1>
                  <section class="product-grid">
                    <article class="product-card">
                        <img src="imagens/oculos.png" alt="Óculos de sol">
                        <h2>Óculos de sol</h2>
                        <br>
                        <p class="price">R$12,00</p>
                        <button class="favorite"><img src="imagens/coraçao de fav2.png"></button>
                        <button class="cart"><img src="imagens/sacola.png" class="img-sacola"></button>
                    </article>
            
                    <article class="product-card">
                        <img src="imagens/colar.png" alt="Conjunto 3 colares de prata">
                        <h2>Conjunto 3 cores de prata</h2>
                        <p class="price">R$29,99 <br>ou em 2x R$15,00</p>
                        <button class="favorite"><img src="imagens/coraçao de fav2.png"></button>
                        <button class="cart"><img src="imagens/sacola.png"class="img-sacola"></button>
                    </article>
            
                    <article class="product-card">
                        <img src="imagens/bolsa.png" alt="Bolsa preta com alça dourada">
                        <h2>Bolsa preta com alça dourada</h2>
                        <p class="price">R$20,00 <br>ou em 2x R$10,00</p>
                        <button class="favorite"><img src="imagens/coraçao de fav2.png"></button>
                        <button class="cart"><img src="imagens/sacola.png"class="img-sacola"></button>
                    </article>
            
                    <article class="product-card">
                        <img src="imagens/aneis.png" alt="Anel de prata">
                        <h2>Anel de prata</h2>
                        <br>
                        <p class="price">R$15,00</p>
                        <button class="favorite"><img src="imagens/coraçao de fav2.png"></button>
                        <button class="cart"><img src="imagens/sacola.png"class="img-sacola"></button>
                    </article>
                  </section>
                </section>
  <!-- Botão Finalizar Compra -->
  <section class="oculto-desktop">
    <a href="/finalizandopagamento"><button class="finalize-button2">Finalizar compra</button></a>
  </section>
  <br>
  <br>

              </main>
              
      <section class="oculto-mobile">
      <!--                                                    Rodapé                                                      -->
      <footer class="footer">
        <img src="imagens/logo2.jpeg" alt="Imagem do Rodapé" class="footer-image">
        <section class="social-media">
          <p class="p-footer">Siga nossas redes sociais</p>
          <ul class="social-links">
            <li><a href="https://facebook.com" target="_blank" class="social-link"><img src="imagens/Facebook.png" alt="Facebook"></a></li>
            <li><a href="https://twitter.com" target="_blank" class="social-link"><img src="imagens/Pinterest.png" alt="Pinterest"></a></li>
            <li><a href="https://www.instagram.com/vintelobrechos" target="_blank" class="social-link"><img src="imagens/Instagram.png" alt="Instagram"></a></li>
          </ul>
        </section>
         <p class="copyright">©2024 Vintélo. Todos os direitos reservados.</p>
      </footer>
      </section>

<script>
// Variáveis globais
let itemPrice = 49.90;
let shippingCost = 10.00;
let discount = 0.00;

// Funções de quantidade
function increaseQuantity(produtoId) {
    const quantityElement = document.getElementById('qty-' + produtoId);
    const currentQuantity = parseInt(quantityElement.textContent);
    const newQuantity = currentQuantity + 1;
    
    fetch('/atualizar-quantidade-sacola', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ produto_id: produtoId, quantidade: newQuantity })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            quantityElement.textContent = newQuantity;
            updateTotals();
            showNotification('Quantidade aumentada!');
        }
    });
}

function decreaseQuantity(produtoId) {
    const quantityElement = document.getElementById('qty-' + produtoId);
    const currentQuantity = parseInt(quantityElement.textContent);
    
    if (currentQuantity > 1) {
        const newQuantity = currentQuantity - 1;
        
        fetch('/atualizar-quantidade-sacola', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ produto_id: produtoId, quantidade: newQuantity })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                quantityElement.textContent = newQuantity;
                updateTotals();
                showNotification('Quantidade diminuída!');
            }
        });
    }
}

// Função para remover item
function removeItem(produtoId) {
    if (confirm('Deseja remover este item da sacola?')) {
        fetch('/remover-item-sacola', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ produto_id: produtoId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Item removido da sacola!');
                location.reload();
            }
        });
    }
}

// Funções de cálculo de frete
function calculateShipping() {
    const cep = document.getElementById('cep').value;
    if (cep.length >= 8) {
        document.getElementById('shipping-options').style.display = 'block';
        showNotification('Opções de frete carregadas!');
    } else {
        showNotification('Digite um CEP válido!');
    }
}

function calculateShippingDesktop() {
    const cep = document.getElementById('cep-desktop').value;
    if (cep.length >= 8) {
        document.getElementById('shipping-options-desktop').style.display = 'block';
        showNotification('Opções de frete carregadas!');
    } else {
        showNotification('Digite um CEP válido!');
    }
}

function updateShipping(cost) {
    shippingCost = cost;
    updateTotals();
    showNotification('Frete atualizado!');
}

function updateShippingDesktop(cost) {
    shippingCost = cost;
    updateTotals();
    showNotification('Frete atualizado!');
}

// Atualizar totais
function updateTotals() {
    // Recarregar a página para obter valores atualizados do backend
    setTimeout(() => {
        location.reload();
    }, 1000);
}

// Sistema de notificações
function showNotification(message) {
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    
    notificationText.textContent = message;
    notification.style.display = 'block';
    notification.classList.add('show');
    
    setTimeout(() => {
        closeNotification();
    }, 3000);
}

function closeNotification() {
    const notification = document.getElementById('notification');
    notification.classList.remove('show');
    setTimeout(() => {
        notification.style.display = 'none';
    }, 300);
}

// Formatar CEP
document.addEventListener('DOMContentLoaded', function() {
    const cepInputs = document.querySelectorAll('#cep, #cep-desktop');
    cepInputs.forEach(input => {
        input.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            e.target.value = value;
        });
    });
});

// Finalizar compra
function finalizarCompra() {
    window.location.href = '/finalizandopagamento';
}
</script>

<style>
/* Estilos para os novos elementos */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #7D2838;
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
}

.notification.show {
    opacity: 1;
    transform: translateX(0);
}

.notification button {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    padding: 0;
    margin-left: 10px;
}

.quantity-control, .quantity-control-desktop {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
}

.qty-btn {
    background: #7D2838;
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.qty-btn:hover {
    background: #5a1e2a;
}

.quantity {
    font-weight: bold;
    min-width: 20px;
    text-align: center;
}

.shipping-section, .shipping-desktop {
    margin: 20px 0;
}

.shipping-form, .shipping-form-desktop {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.shipping-form input, .shipping-form-desktop input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

.shipping-form button, .shipping-form-desktop button {
    background: #7D2838;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
}

.shipping-options, .shipping-options-desktop {
    margin-top: 10px;
}

.shipping-options label, .shipping-options-desktop label {
    display: block;
    margin: 5px 0;
    cursor: pointer;
}

.remove-item {
    background: none;
    border: none;
    cursor: pointer;
}
</style>

<script>
// Funções de quantidade
function increaseQuantity(produtoId) {
    const quantityElement = document.getElementById('qty-' + produtoId);
    const currentQuantity = parseInt(quantityElement.textContent);
    const newQuantity = currentQuantity + 1;
    
    fetch('/atualizar-quantidade-sacola', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ produto_id: produtoId, quantidade: newQuantity })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            quantityElement.textContent = newQuantity;
            showNotification('Quantidade aumentada!');
            setTimeout(() => location.reload(), 1000);
        }
    });
}

function decreaseQuantity(produtoId) {
    const quantityElement = document.getElementById('qty-' + produtoId);
    const currentQuantity = parseInt(quantityElement.textContent);
    
    if (currentQuantity > 1) {
        const newQuantity = currentQuantity - 1;
        
        fetch('/atualizar-quantidade-sacola', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ produto_id: produtoId, quantidade: newQuantity })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                quantityElement.textContent = newQuantity;
                showNotification('Quantidade diminuída!');
                setTimeout(() => location.reload(), 1000);
            }
        });
    }
}

function removeItem(produtoId) {
    if (confirm('Deseja remover este item da sacola?')) {
        fetch('/remover-item-sacola', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ produto_id: produtoId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Item removido da sacola!');
                setTimeout(() => location.reload(), 1000);
            }
        });
    }
}

function showNotification(message) {
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    
    if (notification && notificationText) {
        notificationText.textContent = message;
        notification.style.display = 'block';
        notification.classList.add('show');
        
        setTimeout(() => {
            closeNotification();
        }, 3000);
    }
}

function closeNotification() {
    const notification = document.getElementById('notification');
    if (notification) {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.style.display = 'none';
        }, 300);
    }
}
</script>

</body>
</html>